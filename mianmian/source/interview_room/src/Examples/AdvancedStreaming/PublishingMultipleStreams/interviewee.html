<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>面面：应聘者界面</title>

    <!-- <link rel="icon" href="../../../../favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="../../../assets/css/style.css">
    <link rel="stylesheet" href="./index.css">
    <link rel="stylesheet" href="../../../assets/css/bootstrap.min.css"> -->

    <script src="../../../assets/js/express_sdk/ZegoExpressWebRTC.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.6.1/dist/av-min.js"></script>
    <script src="../../../../../../account/web_prepare01.js"></script>
    <script>
        // 初始化leancloud
        const { Query, User } = AV;
        AV.init({
            appId: "QINFwm0ds2NuLyRCmbpmUltw-gzGzoHsz",
            appKey: "16T8fLd7241TyCxCkCvAYPif",
            serverURL: "https://qinfwm0d.lc-cn-n1-shared.com"
        });
        // 获取interview_number,person_id
        urlinfo = window.location.href; //获取当前页面的url
        len = urlinfo.length;//获取url的长度
        offset = urlinfo.indexOf("?");//设置参数字符串开始的位置
        nowpath = urlinfo.substr(0, offset + 1); // 获取当前路径
        newsidinfo = urlinfo.substr(offset, len); //取出参数字符串 这里会获得类似“id=1”这样的字符串
        newsids = newsidinfo.split("=");//对获得的参数字符串按照“=”进行分割
        now_interview_number = newsids[1];//得到参数值
        newsname = newsids[0];//得到参数名字

        var last_flesh_chat_id = "", last_flesh_chat_time = new Date(2011, 1, 1);
        var interview_number = newsidinfo.split("&")[0].split("=")[1];
        now_interview_number = interview_number;
        var person_id = newsidinfo.split("&")[1].split("=")[1];
        var group_name="";
        var person_name = "曾熙朗";
        var had_init = false, open_screamshoot = false;
        var person_in_time = new Date();

        // 日期转字符串
        function dateToString(date) {
            var y = date.getFullYear();
            var M = date.getMonth() + 1;
            var d = date.getDate();
            var H = date.getHours();
            var m = date.getMinutes();
            var s = date.getSeconds();
            return y + '-' + (M < 10 ? ('0' + M) : M) + '-' + (d < 10 ? ('0' + d) : d) + " " + (H < 10 ? ('0' + H) : H) + ":" + (m < 10 ? ('0' + m) : m) + ":" + (s < 10 ? ('0' + s) : s);
        }

        // 获取工作组信息
        function getWorkGroupInfo() {
            const interviewQuery = new AV.Query('InterviewGroup');
            interviewQuery.get(interview_number).then((interviewGroup) => {
                group_name = interviewGroup.get("group_name");

                // 查询工作组
                const groupQuery = new AV.Query('WorkGroup');
                groupQuery.equalTo('group_name', group_name);
                groupQuery.find().then((tmp_groups) => {
                    if (tmp_groups.length == 0) {
                        console.log("工作组不存在。");
                        return;
                    }
                    document.getElementById("workgroup_name").innerText = tmp_groups[0].get("group_name");
                    document.getElementById("workgroup_email").innerText = tmp_groups[0].get("email");
                    document.getElementById("workgroup_comp").innerText = tmp_groups[0].get("company");
                    document.getElementById("workgroup_target").innerText = tmp_groups[0].get("email_conf");
                });
            });
        }

        // 增加序号
        function editNumber(element) {
            let tmp_val = element.value;

            let numbering_id = tmp_val.split('.').length - 1;
            if (tmp_val[tmp_val.length - 1] == ";" || tmp_val[tmp_val.length - 1] == "；") {
                tmp_val += ("\n" + (numbering_id + 1) + ".");
                element.value = tmp_val;
            }

        }

        // 增加聊天时间
        function addChatTime(chat_time) {
            let new_time = document.createElement("div");
            new_time.innerText = dateToString(chat_time);
            new_time.classList.add("time_show_message");
            document.getElementById("message_content_broad").appendChild(new_time);
        }

        // 添加消息
        function addChatMessage(sender_name, chat_content, is_interviewer, is_file) {
            if (sender_name == person_name) {
                let new_chat = document.createElement("div");
                new_chat.classList.add("me_show_pair");

                sender_name = ("应聘者：" + sender_name);
                if (is_file) {
                    let tmp_file_name = chat_content.split('/').pop();
                    let tmp_name_lth = 0, file_name = "";
                    var pattern = new RegExp("[\u4E00-\u9FA5]+");

                    for (let i = 0; i < tmp_file_name.length; i++) {
                        if (pattern.test(tmp_file_name[i])) {
                            tmp_name_lth += 10;
                        } else tmp_name_lth += 5;
                        if (tmp_name_lth < 46)
                            file_name += tmp_file_name[i];
                        else {
                            file_name += "...";
                            break;
                        }
                    }

                    // 新建文件信息
                    new_chat.innerHTML = '<div class="me_show_name">' +
                        sender_name + '</div><div class="me_show_content">' +
                        '<span class="file_message_icon"><img src="../../../../../../source/pic/icon_move-to-folder.png" alt="图标" srcset="" width="30px"></span><span class="file_message_titlebox"><div class="file_message_title">' +
                        file_name + '</div></span></div>';
                    new_chat.onclick = function () {
                        show_chat_file(chat_content);
                    }
                    document.getElementById("message_content_broad").appendChild(new_chat);
                    new_chat.scrollIntoView();
                } else {
                    new_chat.innerHTML = '<div class="me_show_name">' +
                        sender_name + '</div><div class="me_show_content">' + chat_content + '</div>';
                    document.getElementById("message_content_broad").appendChild(new_chat);
                    new_chat.scrollIntoView();
                }
            } else {
                let new_chat = document.createElement("div");
                new_chat.classList.add("other_show_pair");

                if (is_interviewer) sender_name = ("面试官：" + sender_name);
                else sender_name = ("应聘者：" + sender_name);

                if (is_file) {
                    let tmp_file_name = chat_content.split('/').pop();
                    let tmp_name_lth = 0, file_name = "";
                    var pattern = new RegExp("[\u4E00-\u9FA5]+");

                    for (let i = 0; i < tmp_file_name.length; i++) {
                        if (pattern.test(tmp_file_name[i])) {
                            tmp_name_lth += 10;
                        } else tmp_name_lth += 5;
                        if (tmp_name_lth < 46)
                            file_name += tmp_file_name[i];
                        else {
                            file_name += "...";
                            break;
                        }
                    }

                    // 新建文件信息
                    new_chat.innerHTML = '<div class="other_show_name">' +
                        sender_name + '</div><div class="other_show_content">' +
                        '<span class="file_message_icon"><img src="../../../../../../source/pic/icon_move-to-folder.png" alt="图标" srcset="" width="30px"></span><span class="file_message_titlebox"><div class="file_message_title">' +
                        file_name + '</div></span></div>';
                    new_chat.onclick = function () {
                        show_chat_file(chat_content);
                    }
                    document.getElementById("message_content_broad").appendChild(new_chat);
                    new_chat.scrollIntoView();
                } else {
                    new_chat.innerHTML = '<div class="other_show_name">' +
                        sender_name + '</div><div class="other_show_content">' + chat_content + '</div>';
                    document.getElementById("message_content_broad").appendChild(new_chat);
                    new_chat.scrollIntoView();
                }
            }
        }

        function regetMessage() {

            // 组查询
            const chatQuery = new AV.Query('InterviewChat');
            chatQuery.equalTo('interview_group_number', interview_number);
            chatQuery.ascending('createdAt');

            chatQuery.find().then((chat_msgs) => {
                console.log("getlth:", chat_msgs.length);

                let get_start = false;

                for (let i = 0; i < chat_msgs.length; i++) {
                    if (get_start || last_flesh_chat_id == "") {
                        if (!chat_msgs[i].get('is_public')) {
                            continue;
                        }
                        if (chat_msgs[i].get("createdAt").getTime() < person_in_time.getTime()) {
                            continue;
                        }
                        if (chat_msgs[i].get('createdAt').getTime() - last_flesh_chat_time.getTime() > 1000 * 60 * 5) {
                            last_flesh_chat_time = chat_msgs[i].get('createdAt');
                            addChatTime(last_flesh_chat_time);
                        }
                        addChatMessage(chat_msgs[i].get('sender_name'), chat_msgs[i].get('chat_content'),
                            chat_msgs[i].get('is_interviewer'), chat_msgs[i].get('is_file'));

                        last_flesh_chat_id = chat_msgs[i].get("objectId");
                        get_start = true;
                    } else if (chat_msgs[i].get("objectId") == last_flesh_chat_id) {
                        get_start = true;
                    }
                }


            });
        }

        function send_chat_message(is_file) {
            let chat_content = document.getElementById("send_message_content").value;
            // 声明 class
            const InterviewChat = AV.Object.extend('InterviewChat');
            // 构建对象
            const interviewChat = new InterviewChat();

            // 为属性赋值
            interviewChat.set('chat_content', chat_content);
            interviewChat.set('sender_name', person_name);
            interviewChat.set('is_interviewer', false);
            interviewChat.set('is_public', true);
            interviewChat.set('interview_group_number', interview_number);
            if (is_file) interviewChat.set('is_file', true);

            // 将对象保存到云端
            interviewChat.save().then((todo) => {
                document.getElementById("send_message_content").value = "";
                // 成功保存之后，执行其他逻辑
                console.log(`保存成功。objectId：${todo.id}`);
            }, (error) => {
                // 异常处理
                console.log("上传失败");
            });
        }

        function setOnclicks() {
            // 提前保存按键
            var publish_ipt0 = document.getElementById("PublishID");
            var publish_ipt1 = document.getElementById("PublishSecondID");
            var play_ipt0 = document.getElementById("PlayID");
            var play_ipt1 = document.getElementById("PlaySecondID");

            var Publish_btn0 = document.getElementById("startPublishing");
            var Publish_btn1 = document.getElementById("startSecondPublishing");

            var mianmian_streams = ["0011", "0012", "0013", "0014"];
            // 尝试提前接入
            publish_ipt0.value = mianmian_streams[2];
            publish_ipt1.value = mianmian_streams[3];
            play_ipt0.value = mianmian_streams[0];
            play_ipt1.value = mianmian_streams[1];

            // 登录的设置
            document.getElementById("mianmian_init_btn").onclick = function() {
                if (had_init) {
                    alert("再次初始化前，请刷新网页。");
                    return;
                }
                document.getElementById("LoginRoom").click();
                setTimeout(()=>{
                    if (document.getElementById("roomStateErrorSvg").style.display == "none") {
                        alert("初始化成功。");
                        had_init = true;
                    } else {
                        alert("初始化失败，请刷新网页授权录制音频视频后重试。");
                    }
                }, 1500);
            }

            // 设置按键映射
            // 视频连接键
            document.getElementById("mianmian_camera_btn").onclick = function () {
                // 检查是否初始化
                if (!had_init) {
                    alert('请在初始化后进行音视频的连接。');
                    return;
                }
                // 当按钮为停止连接屏幕
                if (Publish_btn0.innerText == "Stop Publishing") {
                    Publish_btn0.click();

                    setTimeout(() => {
                        if (Publish_btn0.innerText != "Stop Publishing") {
                            // 成功停止
                            console.log("音视频连接以及结束");
                            const tmpInterview = AV.Object.createWithoutData('InterviewGroup', interview_number);
                            tmpInterview.set('interviewee_stream0', undefined);
                            tmpInterview.save();

                            document.getElementById("send_message_content").value = "应聘者已经结束了音视频连接。";
                            send_chat_message()
                            // 更改按键样式
                            document.getElementById("mianmian_camera_title").innerText = "连接视频";
                            document.getElementById("mianmian_camera_title").style.color = "#FFF";
                        } else {
                            // 失败的情况
                            console.log("断开视频连接失败");
                        }
                    }, 2500);
                } else {
                    Publish_btn0.click();

                    setTimeout(() => {
                        if (Publish_btn0.innerText == "Publishing Fail") {
                            alert("请尝试刷新初始化后重试。");
                        } else {
                            document.getElementById("mianmian_camera_title").innerText = "停止连接";
                            document.getElementById("mianmian_camera_title").style.color = "#C42B1C";

                            document.getElementById("send_message_content").value = "应聘者已经开启了音视频连接。";
                            send_chat_message()

                            // 保存信息
                            let tmpInterview = AV.Object.createWithoutData('InterviewGroup', interview_number);
                            tmpInterview.set('interviewee_stream0', person_name);
                            tmpInterview.save();
                        }
                    }, 5000);
                }
            }
            // 共享屏幕键
            document.getElementById("mianmian_showscream_btn").onclick = function () {
                if (!had_init) {
                    alert("请在初始化后进行屏幕共享。");
                    return;
                }
                // 当按钮为停止连接屏幕
                if (Publish_btn1.innerText == "Stop Publishing") {
                    Publish_btn1.click();

                    setTimeout(() => {
                        if (Publish_btn1.innerText != "Stop Publishing") {
                            // 成功停止
                            console.log("音视频连接已经结束");
                            const tmpInterview = AV.Object.createWithoutData('InterviewGroup', interview_number);
                            tmpInterview.set('interviewee_stream1', undefined);
                            tmpInterview.save();

                            document.getElementById("send_message_content").value = "应聘者已经结束了屏幕共享。";
                            send_chat_message()

                            // 更改按键样式
                            document.getElementById("mianmian_showscream_title").innerText = "共享屏幕";
                            document.getElementById("mianmian_showscream_title").style.color = "#FFF";
                        } else {
                            // 失败的情况
                            console.log("断开共享屏幕失败");
                        }
                    }, 2500);
                } else {
                    Publish_btn1.click();

                    setTimeout(() => {
                        if (Publish_btn1.innerText == "Publishing Fail") {
                            alert("请尝试刷新初始化后重试。");
                        } else if (Publish_btn1.innerText == "Stop Publishing") {
                            document.getElementById("mianmian_showscream_title").innerText = "停止共享";
                            document.getElementById("mianmian_showscream_title").style.color = "#C42B1C";

                            document.getElementById("send_message_content").value = "应聘者已经开启了屏幕共享。";
                            send_chat_message()

                            // 保存信息
                            let tmpInterview = AV.Object.createWithoutData('InterviewGroup', interview_number);
                            tmpInterview.set('interviewee_stream1', person_name);
                            tmpInterview.save();
                        } else {
                            document.getElementById("mianmian_showscream_title").innerText = "停止共享";
                            document.getElementById("mianmian_showscream_title").style.color = "#C42B1C";

                            // 保存信息
                            let tmpInterview = AV.Object.createWithoutData('InterviewGroup', interview_number);
                            tmpInterview.set('interviewee_stream1', person_name);
                            tmpInterview.save();
                            // 仍然失败，原因未知
                            console.log("共享屏幕：仍然失败，原因未知");
                        }
                    }, 5000);
                }
            }


        }

        // 拉流
        function getVideoStreams() {
            // 检查是否有在直播
            let audio_on = true, video_on = true;
            const interviewQuery = new AV.Query('InterviewGroup');
            interviewQuery.get(interview_number).then((tmp_interview) => {
                if (tmp_interview.get("interviewer_stream0")=="" || tmp_interview.get("interviewer_stream0")==undefined)
                    audio_on = false;
                if (tmp_interview.get("interviewer_stream1") == "" || tmp_interview.get("interviewer_stream1") == undefined)
                    video_on = false;
            });

            var Play_btn0 = document.getElementById("startPlaying");
            var Play_btn1 = document.getElementById("startSecondPlaying");
            
            // 音频拉流
            if (audio_on) {
                if (Play_btn0.innerText != "Stop Playing") {
                    Play_btn0.click();
                }
            }
            if (video_on) {
                if (Play_btn1.innerText != "Stop Playing") {
                    Play_btn1.click();
                }
            }
        }

        // 切换中屏内容
        function changeCenterVideo() {
            if (document.getElementById("mianmian_myvideo").style.display == "none") {
                document.getElementById("mianmian_myvideo").style.display = "block";
                document.getElementById("mianmian_video").style.display = "none";
            } else {
                document.getElementById("mianmian_myvideo").style.display = "none";
                document.getElementById("mianmian_video").style.display = "block";
            }
        }

        // 发送文件
        function send_message_file() {
            document.getElementById("send_file_dialog").style.display = "block";
        }

        // 发送文件的上传等操作
        function send_chat_File() {
            if (document.getElementById('sendfile_via_slt').selectedIndex == 0) {
                alert("请选择上传文件的方式");
                return;
            } else if (document.getElementById("sendfile__ipt").value == "") {
                alert("请选择文件地址");
                return;
            }
            var file;
            // 上传URL
            if (document.getElementById('sendfile_via_slt').selectedIndex == 1) {
                let file_url = document.getElementById("sendfile__ipt").value;
                // 直接发送信息
                document.getElementById("send_message_content").value = file_url;
                send_chat_message(true);
                document.getElementById("sendfile__ipt").value = "";
                document.getElementById("chat_file_window").style.display = "none";
                return;
            } else {
                // 从本地上传
                const avatarUpload = document.getElementById('sendfile__ipt');
                let file_name = avatarUpload.value.split("\\").pop();
                if (!avatarUpload.files.length) {
                    alert("请输入正确的文件地址。");
                    avatarUpload.value = "";
                    return;
                }
                const localFile = avatarUpload.files[0];
                // 检测文件是否超出大小
                if (localFile.size > 5 * 1024 * 1024) {
                    alert("请选择5MB以下大小的文件");
                    avatarUpload.value = "";
                    return;
                }
                file = new AV.File(file_name, localFile);
            }
            // 保存文件
            file.save().then((file) => {
                console.log(`文件保存完成。URL：${file.url}`);
                // 发送文件的信息
                document.getElementById("send_message_content").value = file.get("url");
                send_chat_message(true);
                document.getElementById("sendfile__ipt").value = "";
                document.getElementById("chat_file_window").style.display = "none";
            }, (error) => {
                // 保存失败，可能是文件无法被读取，或者上传过程中出现问题
                alert("上传失败，文件的读取出现问题。");
                console.log("保存失败");
                document.getElementById("sendfile__ipt").value = "";
                document.getElementById("chat_file_window").style.display = "none";
            });
        }

        function exitInterview() {
            document.getElementById("send_message_content").value = "该面试者已经退出直播间";
            send_chat_message();
            window.close();
        }

        window.onload = function () {
            // alert(interview_number);
            // alert(person_id);

            document.getElementById("__vconsole").style.display = "none";
            document.getElementById("main_content_box").style.width = document.getElementById("main_content_box").offsetWidth+5+"px";

            document.getElementById("video1_box").style.height = Math.ceil(document.getElementById("center_content").offsetWidth * 0.75) + "px";
            // document.getElementById("video2_box").style.height = Math.ceil(document.getElementById("right_content").offsetWidth * 0.75) + "px";
            document.getElementById("video1_box").style.marginTop =
                Math.floor(document.getElementById("center_content").offsetHeight / 2 -
                    document.getElementById("video1_box").offsetHeight / 2) + "px";

            // 获取工作组
            const interviewQuery = new AV.Query('InterviewGroup');
            interviewQuery.get(interview_number).then((now_interview) => {
                // 获取应聘者姓名
                const personQuery = new AV.Query('Vitae');
                personQuery.get(person_id).then((now_person) => {
                    // 获取应聘者姓名
                    person_name = now_person.get("person_name");
                    person_in_time = now_person.get("interview_going_state");

                    // 判断用户是否在工作组中
                    if (now_interview.get("candidate_arr").indexOf(person_name) == -1) {
                        alert("您不在当前的面试场次中");
                        location.assign("../../../../../../index.html");
                    } else {
                        window_onload_inside0();
                    }
                });
            });
        }

        function window_onload_inside0() {
            // 获取信息
            setInterval(() => {
                regetMessage();
            }, 5000);

            // 显示工作组信息
            getWorkGroupInfo();

            // 推流登录开始 63b66791818b282518fd9614
            const zegoQuery = new AV.Query('ZegoUserID');
            zegoQuery.get('63b66791818b282518fd9614').then((now_user_lc) => {

                mianmian_user_id = now_user_lc.get("UserID");
                mianmian_token = now_user_lc.get("Token");
                mianmian_room_id = now_user_lc.get("RoomID");

                document.getElementById("UserID").value = mianmian_user_id;
                document.getElementById("RoomID").value = mianmian_room_id;
                document.getElementById("Token").value = mianmian_token;

                // 保存键位以及推流设置
                setOnclicks();

                // 拉流设置
                setInterval(() => {
                    getVideoStreams();
                }, 10000);

                // 发送文件设置
                document.getElementById("send_file_window").style.top = window.innerHeight / 2 - 135 + "px";
                document.getElementById("send_file_window").style.left = window.innerWidth / 2 - 150 + "px";
                document.getElementById("sendfile_via_slt").onchange = function () {
                    if (this.selectedIndex == 1) {
                        document.getElementById("sendfile__ipt").setAttribute("type", "text");
                        document.getElementById("sendfile_address_pair").style.visibility = "visible";
                    } else if (this.selectedIndex == 2) {
                        document.getElementById("sendfile__ipt").setAttribute("type", "file");
                        document.getElementById("sendfile_address_pair").style.visibility = "visible";
                    } else {
                        document.getElementById("sendfile_address_pair").style.visibility = "hidden";
                    }
                }

                // 打开文件样式表
                document.getElementById("chat_file_window").style.left = window.innerWidth / 2 - 300 + "px";
                document.getElementById("chat_file_window").style.top = window.innerHeight / 2 - 262 + "px";

                document.getElementById("send_message_content").value = "应聘者已经进入直播间";
                send_chat_message();
            });
        }
    </script>
    <style>
        html,
        body {
            width: 100%;
            min-width: 1100px;
            height: 100%;
            min-height: 550px;

            margin: 0;
            text-align: center;
        }

        body {
            background-color: #23272A;
        }

        .main_content {
            width: calc(100% - 10px);
            margin-left: 5px;
            min-width: 1100px;
            height: 100%;
            /* overflow: hidden; */
        }

        #top_title {
            width: 100%;
            float: left;

            height: 35px;
            background-color: #23272A;

            color: #eee;
            line-height: 35px;
            text-align: center;
        }

        #left_content {
            display: block;
            width: 350px;

            min-width: 200px;
            height: calc(100% - 35px);

            float: left;
            background-color: #aaa;
        }

        #center_content {
            display: block;

            float: left;
            width: calc(100% - 674px);
            min-width: 350px;
            height: calc(100% - 35px);

            overflow: hidden;
            background-color: #3B3F42;
            text-align: center;
        }

        #right_content {
            display: block;

            float: left;
            width: 300px;
            min-width: 200px;
            height: calc(100% - 35px);

            background-color: #3B3F42;
            overflow: hidden;
        }

        .size_change_width_btn {
            width: 10px;
            height: calc(100% - 35px);

            float: left;
            background-color: #aaa;
            color: #fff;

            vertical-align: middle;
            position: relative;
        }

        .size_change_height_btn {
            height: 10px;
            width: 100%;
            line-height: 10px;

            text-align: center;
            color: #fff;
            background-color: #aaa;
        }

        .size_change_height_btn:hover {
            background-color: #ccc;
            cursor: ns-resize;
            user-select: none;
        }

        .size_change_width_btn:hover {
            filter: brightness(1.2);
            cursor: ew-resize;
            user-select: none;
        }

        .size_change_width_btn div {
            position: absolute;
            top: calc(50% - 10px);
        }

        #resize_fuzhu_btn0 {
            position: absolute;
            margin-top: 35px;
        }

        #resize_fuzhu_btn2 {
            position: absolute;
        }

        /* 设置左侧信息栏 */
        #vitae_box {
            width: 100%;
            height: calc(50% - 5px);
            min-height: 200px;

            background-color: #3B3F42;
            position: relative;
        }

        #assess_note_box {
            width: 100%;
            height: calc(50% - 5px);
            min-height: 200px;

            background-color: #3B3F42;
            position: relative;
        }


        /* 中间视频栏目 */
        #video1_box {
            width: 100%;
            height: 240px;
            background-color: #000;
        }

        /* 右侧视频部分 */
        #video2_box {
            width: 100%;
            height: 225px;
            background-color: #000;
        }

        /* 右侧聊天框 */
        #message_box {
            width: 100%;
            height: calc(100% - 225px);

            background-color: #23272A;
        }

        #message_title {
            height: 35px;
            width: 100%;

            text-align: center;
            background-color: #54585b;
        }

        /* 信息发送按钮 */
        /* #message_send_box {
            height: 35px;
            width: 100%;

            background-color: #54585b;
            text-align: center;
        }

        #send_message_btn {
            width: 80px;
            height: 30px;
            margin-top: 2px;

            font-size: 16px;
            line-height: 30px;
            color: #fff;
            border-radius: 8px;

            display: inline-block;
            background-color: #71787e;
        }

        #send_message_btn:hover {
            filter: brightness(1.2);
            cursor: pointer;
            user-select: none;
        }

        #send_message_content {
            background-color: #71787e;
            color: #fff;

            height: 24px;
            border: 1px solid #b7bec4;
            font-size: 18px;

            border-radius: 8px;
            margin-top: 2px;
            margin-right: 5px;
            width: calc(100% - 120px);

            text-indent: 5px;
        } */

                #message_send_box {
            height: 35px;
            width: 100%;

            background-color: #54585b;
            text-align: center;
        }
        .send_message_btn {
            width: 30px;
            height: 30px;
            margin-top: 2px;
            margin-left: 2px;
            margin-right: 3px;

            font-size: 16px;
            line-height: 30px;
            color: #fff;
            border-radius: 15px;

            display: inline-block;
            float: left;
            background-color: #71787e;
        }
        .send_message_btn img {
            margin-top: 5px;
            filter: invert(100%);
        }
        .send_message_btn:hover {
            filter: brightness(1.2);
            cursor: pointer;
            user-select: none;
        }

        .send_message_content_box {
            float: left;
            display: inline-block;
            height: 30px;
            width: calc(100% - 90px);

            padding-left: 5px;
            padding-right: 10px;
            padding-bottom: 3px;
        }
        #send_message_content {
            background-color: #71787e;
            color: #fff;

            height: 22px;
            border: 1px solid #b7bec4;
            font-size: 18px;

            border-radius: 8px;
            margin-top: 2px;
            padding-bottom: 5px;
            margin-right: 5px;
            width: 100%;

            text-indent: 5px;
            bottom: 5px;
        }

        /* 信息发送内容 */
        #message_content_box {
            width: 100%;
            height: calc(100% - 72px);
            text-align: center;

            background-color: #3B3F42;
            overflow-y: scroll;
        }

        #message_content_broad {
            width: 100%;
            height: 100%;
        }

        .time_show_message {
            padding-top: 5px;
            padding-bottom: 5px;
            font-size: 13px;

            color: #fff;
        }

        .other_show_pair {
            padding: 5px;
            text-align-last: left;

            color: #fff;
        }

        .other_show_name {
            font-size: 13px;

        }

        .other_show_content {
            font-size: 16px;

            margin-left: 10px;
            margin-right: 20px;
            padding: 5px;
            border-radius: 5px;
            max-width: calc(100% - 50px);

            word-wrap: break-word;
            word-break: break-all;

            display: inline-block;
            background-color: #5d6062;
        }

        .me_show_pair {
            padding: 5px;
            text-align-last: right;

            color: #fff;
        }

        .me_show_name {
            font-size: 13px;

        }

        .me_show_content {
            font-size: 16px;

            margin-left: 20px;
            margin-right: 10px;
            padding: 5px;
            border-radius: 5px;
            max-width: calc(100% - 50px);

            word-wrap: break-word;
            word-break: break-all;

            color: #000;
            text-align: left;
            display: inline-block;
            background-color: rgb(169, 210, 233);
        }
        /* 关于文件信息 */
        .file_message_icon {
            float: left;
            padding-left: 5px;
            filter: invert(100%);
            user-select: none;
            cursor: pointer;
        }
        .file_message_titlebox {
            float: left;
            padding-left: 5px;
            padding-right: 5px;
            cursor: pointer;
        }
        .file_message_title {
            margin-top: 8px;
            font-size: 12px;
            height: 16px;
            width: 80px;
            overflow: hidden;
        }

        /* 信息栏 */
        .message_title_case {
            display: inline-block;

            font-size: 18px;
            line-height: 25px;
            padding: 5px;
            padding-bottom: 2px;
            color: white;
            margin-left: 5px;
            margin-right: 5px;
        }

        .message_title_case:hover {
            border-bottom: 2px solid rgb(82, 103, 115);
            cursor: pointer;

        }

        .chose_message_title_case {
            border-bottom: 2px solid rgb(169, 210, 233);
        }

        /* 中侧设置按钮框 */
        #center_btn_box {
            position: absolute;
            bottom: 5px;
            height: 70px;
            /* width: 370px; */
            margin-left: calc(50% - 185px);

            background-color: rgba(100, 100, 100, 0.7);
            text-align: center;
            border-radius: 5px;
            /* background-color: #fff; */
        }

        .center_btn img {
            filter: invert(100%);
        }

        .center_btn {
            display: inline-block;
            font-size: 13px;
            color: #fff;
            background-color: rgba(100, 100, 100, 0.7);

            width: 60px;
            height: 55px;
            margin-top: 5px;
            margin-bottom: 5px;
            margin-left: 5px;
            margin-right: 5px;
            padding-top: 5px;

            border-radius: 5px;
            text-align: center;
        }

        .center_btn:hover {
            filter: brightness(0.8);
            cursor: pointer;
            user-select: none;
        }

        /* 左侧工作组信息内容 */
        #workgroup_info_box {
            width: 100%;
            height: 100%;
            text-align: center;

            overflow-y: scroll;
        }
        #workgroup_info_title {
            font-size: 25px;
            text-align: center;
            color: #fff;

            /* font-weight: 600; */
            padding-top: 20px;
            padding-bottom: 20px;
        }
        .workgroup_info_pair {
            width: 80%;

            margin-left: auto;
            margin-right: auto;
            padding-top: 5px;
            padding-bottom: 5px;
        }
        .workgroup_info_key {
            font-size: 15px;
            font-weight: 500;
            color: #fff;

            text-align: left;
        }
        .workgroup_info_val {
            font-size: 20px;
            color: #fff;
            font-family: 'Times New Roman', Times, serif;

            text-align: left;
        }
        /* 左下侧记事本 */
        #notebook_box {
            width: 100%;
            height: 100%;
            text-align: center;

            overflow-y: scroll;
        }
        #notebook_title {
            font-size: 25px;
            color: #fff;
            padding-top: 20px;
            padding-bottom: 20px;

            text-align: center;
        }
        #notebook_content {
            width: calc(100% - 14);
            padding-left: 5px;
            padding-right: 5px;
            min-height: calc(100% - 90px);
            border: 1px solid #ddd;

            background-color: #595f63;

            color: #fff;
            text-align: left;
        }
    </style>
</head>

<body>

    <!-- 源loginin -->
    <button id="LoginRoom" class="play-pause-button" title="loginRoom()" style="width: 120px; display: none;">
        <div class="success-svg m-r-5" id="loginSuccessSvg" style="display: none;">
            <svg class="ft-green-tick" xmlns="http://www.w3.org/2000/svg" height="15" width="15" viewBox="0 0 48 48"
                aria-hidden="true">
                <circle class="circle" fill="#5bb543" cx="24" cy="24" r="22" />
                <path class="tick" fill="none" stroke="#FFF" stroke-width="6" stroke-linecap="round" stroke-linejoin="round"
                    stroke-miterlimit="10" d="M14 27l5.917 4.917L34 17" />
            </svg>
        </div>
        Login Room
    </button>

    <!-- 隐藏后端内容 -->
    <!-- 第一个输入流视频，作为音频输入，不展示文字 -->
    <div class="preview-content" style="display: none;">
        <div class="preview-action">
            <div class="preview-info">
                <span data-lang="PlayFirstStream">Play First Stream</span>
            </div>
    
        </div>
        <video controls id="playVideo" autoplay playsinline></video>
        <div id="remoteVideo1"></div>
    </div>
    
<!-- 无用部分 -->
    <div class="preloader" style="display: none;">
        <svg class="circular" viewBox="25 25 50 50">
            <circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="2" stroke-miterlimit="10" />
        </svg>
    </div>
    
    <div class="container main-wrapper" style="display: none;">
        <!-- <div class="row"> -->
    
        <div class="page-wrapper">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-12 login-wrapper">
                        <h6 data-lang="Preconditions">前置条件</h6>
                        <div class="login-desc" data-lang="PreconditionsDesc">
                            体验该功能，需要模拟一个用户（UserID）登陆到对应的房间（RoomID）中，并且有权限（Token）时才可以登陆成功。
                        </div>
                        <div class="form-wrap font-14 row">
                            <div class="form-item col-12 col-lg-4">
                                <span>RoomID</span>
                                <div class="icon-question">?
                                    <div class="pop-box" data-lang="RoomIDDesc">Tooltip text</div>
                                </div>
                                <input type="text" id="RoomID" />
                            </div>
                            <div class="form-item col-12 col-lg-4">
                                <span>UserID</span>
                                <div class="icon-question">?
                                    <div class="pop-box">
                                        <span data-lang="UserIDDesc"></span>
                                    </div>
                                </div>
                                <input type="text" id="UserID" />
                            </div>
                            <div class="form-item col-12 col-lg-4">
                                <span>Token</span>
                                <div class="icon-question">?
                                    <div class="pop-box">
                                        <span data-lang="TokenDesc"></span>
                                        <a href="https://console.zego.im" data-lang="ApplyToken" target="_blank"></a>
                                    </div>
                                </div>
                                <input type="text" class="w-70" id="Token" />
                            </div>
                        </div>

                    </div>
                </div>
                <div class="preview-roomInfo">
                    RoomID:&nbsp;<div id="roomInfo-id" class="m-r-10"></div>
                    RoomState:&nbsp;<div id="roomInfo-state">
                        <div class="success-svg" id="roomStateSuccessSvg" style="display: none;">
                            <svg class="ft-green-tick" xmlns="http://www.w3.org/2000/svg" height="10" width="10"
                                viewBox="0 0 48 48" aria-hidden="true">
                                <circle class="circle" fill="#5bb543" cx="24" cy="24" r="22" />
                            </svg>
                        </div>
                        <div class="error-svg" id="roomStateErrorSvg" style="display: inline-block;">
                            <svg class="ft-green-tick" xmlns="http://www.w3.org/2000/svg" height="10" width="10"
                                viewBox="0 0 48 48" aria-hidden="true">
                                <circle class="circle" fill="#5bb543" cx="24" cy="24" r="22" />
                            </svg>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 preview-wrapper m-t-10">
                        <div class="font-bold">Step1</div>
                        <div class="row" id="videoList">
                            <div class="preview-pushlishInfo col-6 m-b-10">
    
                                <div class="">
                                    <div class="m-t-10 m-b-5">
                                        Publish StreamID <input class="m-l-10" type="text" id="PublishID" />
                                    </div>
                                    <button id="startPublishing" class="m-b-5 configBtn play-pause-button"
                                        title="createStream() / startPublishingStream()">Start Publishing</button>
                                </div>
                            </div>
                            <div class="preview-pushlishInfo col-6 m-b-10">
    
                                <div class="">
                                    <div class="m-t-10 m-b-5">
                                        Publish StreamID <input class="m-l-10" type="text" id="PublishSecondID" />
                                    </div>
                                    <button id="startSecondPublishing" class="m-b-5 configBtn play-pause-button"
                                        title="createStream() / startPublishingStream()">Start
                                        Publishing</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 preview-wrapper m-t-10">
                        <div class="font-bold">Step2</div>
                        <div class="row" id="videoList">
                            <div class="preview-playInfo col-6 m-b-10">
    
                                <div class="">
                                    <div class="m-t-10 m-b-5">
                                        Playing StreamID <input class="m-l-10" type="text" id="PlayID" />
                                    </div>
                                    <button id="startPlaying" class="m-b-5 configBtn play-pause-button"
                                        title="startPlayingStream()">Start Playing</button>
                                </div>
                            </div>
                            <div class="preview-playInfo col-6">
    
                                <div class="">
                                    <div class="m-t-10 m-b-5">
                                        Playing StreamID <input class="m-l-10" type="text" id="PlaySecondID" />
                                    </div>
                                    <button id="startSecondPlaying" class="m-b-5 configBtn play-pause-button"
                                        title="startPlayingStream()">Start Playing</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <ul class="goToDoc">
                <li>
                    <span data-lang="HelpDocsVideoCodec"> Web 端视频编码默认使用 VP8。如果需要体验和其他端互通或者转推 CDN 功能，请在调试与配置页面修改为
                        H.264。</span>
                    &nbsp;
                    <a href="../../DebugAndConfig/LogAndVersionAndDebug/index.html" data-lang="HelpSettingsPage"
                        target="_blank">
                        点击修改 </a>
                </li>
                <li>
                    <span data-lang="MoreDocs">更多文档，请跳转至即构 </span> &nbsp;
                    <a href="https://doc-zh.zego.im/article/4855" data-lang="HelpDocs" target="_blank"> 帮助文档 </a>
                </li>
            </ul>
        </div>
        <!-- </div> -->
    </div>

<!-- 有用部份 -->
    <!-- 页面内容 -->
    <div class="main_content" id="main_content_box">
        <div id="top_title" title="面试信息">
            面面会议：应聘者端画面
        </div>

        <!-- 左侧信息栏 -->
        <span id="left_content">

            <div id="vitae_box">
                <div id="workgroup_info_box">
                    <div id="workgroup_info_title">工作组信息</div>
                    <div class="workgroup_info_pair">
                        <div class="workgroup_info_key">工作组名称</div>
                        <div class="workgroup_info_val" id="workgroup_name">xxx工作组</div>
                    </div>
                    <div class="workgroup_info_pair">
                        <div class="workgroup_info_key">工作组邮箱</div>
                        <div class="workgroup_info_val" id="workgroup_email">xxx@example.com</div>
                    </div>
                    <div class="workgroup_info_pair">
                        <div class="workgroup_info_key">所属企业</div>
                        <div class="workgroup_info_val" id="workgroup_comp">xxx公司</div>
                    </div>
                    <div class="workgroup_info_pair">
                        <div class="workgroup_info_key">招聘岗位</div>
                        <div class="workgroup_info_val" id="workgroup_target">xxx工作组</div>
                    </div>
                    <div style="height: 30px; width: 100px;"></div>
                </div>
            </div>

            <span class="size_change_height_btn" id="resize_btn3" style="background-color: #aaa;">
                <div>═</div>
            </span>

            <div id="assess_note_box">
                <div id="notebook_box">
                    <div id="notebook_title">草稿本</div>
                    <div id="notebook_content" contenteditable="true"></div>
                    <div style="height: 20px; width: 100%;"></div>
                </div>
            </div>
            <!-- 移动辅助线 -->
            <span class="size_change_height_btn" id="resize_fuzhu_btn2"
                style="display: none; background-color: rgba(255, 255, 255, 0.6);">
                <div>═</div>
            </span>
        </span>
        <span class="size_change_width_btn" id="resize_btn1">
            <div>‖</div>
        </span>

        <!-- 中央信息栏 -->
        <span id="center_content">
            <div id="video1_box">

                <!-- 第二个输出流视频 -->
                <div class="preview-content" id="mianmian_myvideo" style="height: 100%; width: 100%;" title="您的屏幕共享内容">
                    <div class="preview-action">
                        <div class="preview-info">
                            <span data-lang="PublishScreenStream">您的屏幕共享内容</span>
                        </div>
                
                    </div>
                    <video controls id="publishSecondVideo" autoplay muted playsinline></video>
                    <div id="localVideo2"></div>
                </div>

                <!-- 第二个输入流视频 -->
                <div class="preview-content" id="mianmian_video" style="height: 100%; width: 100%; display: none;" title="应聘者屏幕共享内容">
                    <div class="preview-action">
                        <div class="preview-info">
                            <span data-lang="PlaySecondStream">面试官屏幕共享内容</span>
                        </div>
                
                    </div>
                    <video controls id="playSecondVideo" autoplay playsinline></video>
                    <div id="remoteVideo2"></div>
                </div>
            </div>
        </span>

        <span class="size_change_width_btn" id="resize_btn2">
            <div>‖</div>
        </span>

        <!-- 右侧信息栏目 -->
        <span id="right_content">
            <div id="video2_box" style="overflow:hidden;">
                <!-- 第一个 输出流视频 -->
                <div class="preview-content" id="mianmian_camera" style="height: 100%; width: 100%;">
                    <div class="preview-action" style="display: none;">
                        <div class="preview-info">
                            <span data-lang="PublishCameraStream">您的摄像头内容</span>
                        </div>
                
                    </div>
                    <video controls id="publishVideo" autoplay muted playsinline></video>
                    <div id="localVideo1"></div>
                </div>
            </div>
            <div id="message_box">
                <!-- 消息头部选项 -->
                <div id="message_title">
                    <span class="message_title_case chose_message_title_case" id="public_chat_btn"
                        onclick="">公共频道</span>
                </div>
                <!-- 信息栏目 -->
                <div id="message_content_box">
                    <div id="message_content_broad">
                        <!-- <div class="time_show_message">
                            xxxx-xx-xx xx:xx
                        </div>
                        <div class="other_show_pair">
                            <div class="other_show_name">
                                xxx
                            </div>
                            <div class="other_show_content">
                                xxxneirong
                            </div>
                        </div>
                        <div class="me_show_pair">
                            <div class="me_show_name">
                                wo
                            </div>
                            <div class="me_show_content">
                                xxx_show_messagesaddddddddddddddddddddddddddddddddddddddddddddddd
                            </div>
                        </div> -->
                    </div>
                </div>
                <!-- 信息发送按钮 -->
                <div id="message_send_box">
                    <!-- <input id="send_message_content" type="text">
                    <span id="send_message_btn" onclick="send_chat_message();">发 送</span> -->
                    <span class="send_message_content_box">
                        <input id="send_message_content" type="text">
                        <!-- <div style="height: 5px; width: 100%; background-color: rgba(255, 255, 255, 0); line-height: 5px; font-size: 1px;">dfg</div> -->
                    </span>
                    <span class="send_message_btn" onclick="document.getElementById('send_file_window').style.display = 'block';">
                        <img src="../../../../../../source/pic/icon_move-to-folder-2.png" width="20px" alt="" srcset="">
                    </span>
                    <span class="send_message_btn" onclick="send_chat_message();">
                        <img src="../../../../../../source/pic/icon_check.png" width="20px" alt="" srcset="">
                    </span>
                </div>
            </div>
        </span>

        <!-- 底部控件 -->
        <div id="center_btn_box">
            <div class="center_btn" id="mianmian_init_btn" title="请在通过音频、视频授权后点击初始化，否则请刷新网页重新授权。">
                <img src="../../../../../../source/pic/icon_snowplow.png" alt="" srcset="" width="35px">
                <div class="center_btn_title">
                    初始化
                </div>
            </div>
            <div class="center_btn" id="mianmian_camera_btn" title="为保证音频质量，面试官请勿同时开启音频">
                <img src="../../../../../../source/pic/icon_camcorder.png" alt="" srcset="" width="35px">
                <div class="center_btn_title" id="mianmian_camera_title">
                    连接视频
                </div>
            </div>
            <div class="center_btn" title="为保证音频质量，面试官请勿同时开启音频"
                id="mianmian_showscream_btn">
                <img src="../../../../../../source/pic/icon_display-code.png" alt="" srcset="" width="35px">
                <div class="center_btn_title" id="mianmian_showscream_title">
                    屏幕共享
                </div>
            </div>
            <div class="center_btn" title="切换面试官共享的屏幕与自己的屏幕" id="mianmian_changescream_btn"
                onclick="changeCenterVideo();">
                <img src="../../../../../../source/pic/icon_replace.png" alt="" srcset="" width="35px">
                <div class="center_btn_title" id="mianmian_changescream_title">
                    切换屏幕
                </div>
            </div>
            <div class="center_btn" title="为保证音频质量，面试官请勿同时开启音频">
                <img src="../../../../../../source/pic/icon_sign-out-alt.png" alt="" srcset="" width="35px">
                <div class="center_btn_title">
                    退出面试
                </div>
            </div>
        </div>

        <!-- 辅助竖线 -->
        <span class="size_change_width_btn" id="resize_fuzhu_btn0"
            style="display: none; background-color: rgba(255, 255, 255, 0.6);">
            <div>‖</div>
        </span>

<!-- 发送文件样式文件 -->
<style>
    #send_file_window {
        width: 300px;

        background-color: rgb(250, 250, 250);
        border-radius: 8px;

        position: absolute;

        overflow: hidden;
    }

    .send_file_title {
        font-size: 20px;
        padding: 20px;
        padding-top: 30px;
    }

    /* 按键框 */
    .sendfile_dialog_btnbox {
        width: 100%;
        padding-top: 10px;
        padding-bottom: 10px;

        /* padding-right: 20px; */
        text-align: center;

        background-color: #eee;
    }

    .sendfile_btn {
        font-size: 15px;
        text-align: center;

        display: inline-block;
        padding: 3px;
        padding-left: 10px;
        padding-right: 10px;
        width: 110px;

        margin-left: 5px;
        margin-right: 5px;
        border-radius: 8px;
        background-color: #0178D4;
        color: #fff;
    }

    .sendfile_btn:hover {
        cursor: pointer;
        filter: brightness(0.8);
    }

    /* 内容框 */
    .sendfile_pair {
        width: 150px;
        margin-left: auto;
        margin-right: auto;

        text-align: left;
        padding-bottom: 20px;
    }

    .sendfile_key {
        font-size: 15px;
        font-weight: 600;
    }

    #sendfile__ipt {
        height: 26px;
        font-size: 15px;
        width: 142px;
        /* border: 1px solid #000; */
    }

    .sendfile_val {
        width: 100%;
        height: 25px;

        font-size: 18px;
    }
</style>
    <div id="send_file_window" style="display: none;">
        <div class="send_file_title">
            请选择需要发送的文件
        </div>
        <div class="sendfile_pair">
            <div class="sendfile_key">发送方式</div>
            <select class="sendfile_val" id="sendfile_via_slt">
                <option selected disabled="disabled" label="上传方式"></option>
                <option>URL</option>
                <option>本地上传</option>
            </select>
        </div>
        <div class="sendfile_pair" id="sendfile_address_pair" style="visibility: hidden;">
            <div class="sendfile_key">文件地址</div>
            <input type="text" class="sendfile_val" id="sendfile__ipt" placeholder="请输入文件地址">
        </div>
        <div class="sendfile_dialog_btnbox" style="margin-top: 10px;">
            <span class="sendfile_btn" id="sendfile_btn"
                onclick="send_chat_File();document.getElementById('send_file_window').style.display='none';">
                确定
            </span>
            <span class="sendfile_btn" id="sendfile_exit_btn"
                onclick="document.getElementById('send_file_window').style.display='none';">
                取消
            </span>
        </div>
    </div>

<!-- 打开文件样式表 -->
<style>
    #chat_file_window {
        width: 600px;
        margin: auto;

        background-color: rgb(250, 250, 250);
        border-radius: 8px;

        overflow: hidden;
        text-align: center;
        position: absolute;
    }

    .chatfile_dialog_title {
        font-size: 20px;
        padding: 20px;
        text-align: left;
    }

    /* 按键框 */
    .chatfile_show_btnbox {
        width: 100%;
        padding-top: 10px;
        padding-bottom: 10px;

        /* padding-right: 20px; */
        text-align: right;

        background-color: #eee;
    }

    .chatfile_show_btn {
        font-size: 15px;
        text-align: center;

        display: inline-block;
        padding: 3px;
        padding-left: 10px;
        padding-right: 10px;
        width: 110px;

        margin-right: 10px;
        border-radius: 8px;
        background-color: #0178D4;
        color: #fff;
    }

    .chatfile_show_btn:hover {
        cursor: pointer;
        filter: brightness(0.8);
    }

    /* 显示框样式 */
    #chatfile_show_box {
        width: 500px;
        height: 400px;
        margin-left: auto;
        margin-right: auto;
        /* background-color: darkcyan; */
    }

    .chatfile_show_broad {
        width: 100%;
        height: 100%;
        display: none;
    }

    #chatfile_show_broad3 img {
        display: block;
        margin-left: auto;
        margin-right: auto;

        padding-top: 100px;
        padding-bottom: 30px;
    }
</style>
<!-- 打开对话文件 -->
    <div id="chat_file_window" style="display: none;">
        <div class="chatfile_dialog_title">
            文件预览
        </div>
        <div id="chatfile_show_box">
            <iframe src="" frameborder="0" class="chatfile_show_broad" id="chatfile_show_broad0"></iframe>
            <video src="" class="chatfile_show_broad" id="chatfile_show_broad1"></video>
            <img src="" alt="" class="chatfile_show_broad" id="chatfile_show_broad2">
            <div class="chatfile_show_broad" id="chatfile_show_broad3">
                <img src="../../../../../../source/pic/icon_file-excel.png" width="100px" alt="" srcset="">
                暂不支持当前的文件类型，请下载查看。支持的文件类型有docx、
                pptx、xlsx、ogg、mp4、webm、png、jpeg、gif、apng、svg、bmp、jpg。
            </div>
            <div class="chatfile_show_broad" id="chatfile_show_broad4"></div>
        </div>
        <div class="chatfile_show_btnbox" style="margin-top: 10px;">
            <span class="chatfile_show_btn" id="file_download_btn">
                下载
            </span>
            <span class="chatfile_show_btn" id="chatfile_show_exit_btn"
                onclick="document.getElementById('chat_file_window').style.display='none';">
                关闭
            </span>
        </div>
    </div>
<script src="./pdfOnLine.js"></script>
<script>
    function show_chat_file(url) {

        // 删除原有内容
        let tmp_file_broads = document.getElementsByClassName("chatfile_show_broad");
        for (let i = 0; i < tmp_file_broads.length; i++) {
            tmp_file_broads[i].setAttribute("src", "");
            tmp_file_broads[i].style.display = "none";
            if (i == 3) continue;
            tmp_file_broads[i].innerHTML = "";
        }

        // 开始展示
        let tuozhanming = url.split('.').pop();
        let src_web_address = "";
        if (tuozhanming == "doc" || tuozhanming == "docx") {
            console.log("展示doc文件");
            src_web_address = "https://view.officeapps.live.com/op/view.aspx?src=" + url;
            document.getElementById('chatfile_show_broad0').setAttribute("src", src_web_address);
            document.getElementById('chatfile_show_broad0').style.display = "block";
        } else if (tuozhanming == "pptx" || tuozhanming == "ppt") {
            console.log("展示pptx文件");
            src_web_address = "https://view.officeapps.live.com/op/embed.aspx?src=" + url;
            document.getElementById('chatfile_show_broad0').setAttribute("src", src_web_address);
            document.getElementById('chatfile_show_broad0').style.display = "block";
        } else if (tuozhanming == "xlsx") {
            console.log("展示xlsx文件");
            src_web_address = "https://view.officeapps.live.com/op/embed.aspx?src=" + url;
            document.getElementById('chatfile_show_broad0').setAttribute("src", src_web_address);
            document.getElementById('chatfile_show_broad0').style.display = "block";
        } else if (tuozhanming == "xls" || tuozhanming == "pdf") {
            console.log("展示xls文件");
            src_web_address = url;
            document.getElementById('chatfile_show_broad0').setAttribute("src", src_web_address);
            document.getElementById('chatfile_show_broad0').style.display = "block";
        } else if (tuozhanming == "webm" || tuozhanming == "mp4" || tuozhanming == "ogg") {
            console.log("展示视频文件ogg、mp4、webm");
            src_web_address = url;
            document.getElementById('chatfile_show_broad1').setAttribute("src", src_web_address);
            document.getElementById('chatfile_show_broad1').style.display = "block";
        } else if (["jpeg", "gif", "png", "apng", "svg", "bmp", "jpg"].indexOf(tuozhanming) != -1) {
            src_web_address = url;
            console.log("展示图片文件jpeg、gif、png、apng、svg、bmp");
            document.getElementById('chatfile_show_broad2').setAttribute("src", src_web_address);
            document.getElementById('chatfile_show_broad2').style.display = "block";
        } else if (tuozhanming == "pdf") {
            var options = {
                height: "400px",
                width: "500px",
                pdfOpenParams: { view: 'FitV', page: '0' },
                name: "pdf_file",
                fallbackLink: "<p>您的浏览器暂不支持此pdf，请下载最新的浏览器</p>"
            };
            PDFObject.embed(url, "#chatfile_show_broad4", options);
            document.getElementById("chatfile_show_broad4").style.display = "block";
        } else {
            console.log("无法显示。");
            document.getElementById('chatfile_show_broad3').style.display = "block";
        }

        document.getElementById("chat_file_window").style.display = "block";
        // 设置下载按键
        document.getElementById("file_download_btn").onclick = function () {
            window.open(url);
        }
    }

</script>

        <script>
            var oDiv0 = document.getElementById('resize_btn1'),
                oDiv1 = document.getElementById('resize_btn2'),
                oDiv2 = document.getElementById('resize_btn3');
            var move0_left = document.getElementById("left_content").offsetWidth;
            var move0_top = 0;

            // 按键1的设置
            oDiv0.onmousedown = function (ev) {
                // 获取event对象，兼容性写法
                var ev = ev || event;

                // 鼠标按下时的位置
                var mouseDownX = ev.clientX;
                var mouseDownY = ev.clientY;

                // 方块上下左右四个边的位置和方块的长宽
                var L0 = this.offsetLeft;
                var R0 = this.offsetLeft + this.offsetWidth;
                var W = this.offsetWidth;
                var H = this.offsetHeight;

                // 设置方块的识别范围
                var areaL = L0 + 10;
                var areaR = R0 - 10;

                // 判断改变方块的大小的方向
                var changeL = mouseDownX < L0; // 左
                var changeR = mouseDownX > R0; // 右

                console.log("start");

                // IE8 取消默认行为-设置全局捕获
                if (oDiv0.setCapture) {
                    oDiv0.setCapture();
                }

                document.onmousemove = function (ev) {
                    var ev = ev || event;

                    // 鼠标移动时的鼠标位置
                    var mouseMoveX = ev.clientX;
                    var mouseMoveY = ev.clientY;

                    console.log("width:" + W);
                    document.getElementById("resize_fuzhu_btn0").style.display = "block";
                    if (mouseMoveX <= 205) {
                        document.getElementById("resize_fuzhu_btn0").style.left = 200 + "px";
                    } else if (mouseMoveX >=
                        document.getElementById("center_content").offsetWidth +
                        document.getElementById("left_content").offsetWidth - 355) {
                        document.getElementById("resize_fuzhu_btn0").style.right =
                            Math.floor(document.getElementById("center_content").offsetWidth +
                                document.getElementById("left_content").offsetWidth - 350) + "px";
                    } else {
                        document.getElementById("resize_fuzhu_btn0").style.left = mouseMoveX - 5 + "px";
                    }

                    // 设置移动数据
                    move0_left = document.getElementById("resize_fuzhu_btn0").offsetLeft;
                    console.log(move0_left);
                }

                document.onmouseup = function () {

                    document.onmousemove = null;
                    document.getElementById("resize_fuzhu_btn0").style.display = "none";


                    // 调整尺寸
                    let left_move = move0_left;
                    let move_distance = document.getElementById("left_content").offsetWidth - left_move;
                    // alert("former"+ document.getElementById("left_content").offsetWidth + "," +document.getElementById("center_content").offsetWidth
                    //     +"\nmdis:"+move_distance);    
                    if (move_distance > 0) {
                        document.getElementById("center_content").style.width = Math.floor(document.getElementById("center_content").offsetWidth + move_distance) + "px";
                        document.getElementById("left_content").style.width = Math.floor(document.getElementById("left_content").offsetWidth - move_distance) + "px";
                    } else if (move_distance < 0) {
                        let tmp_center_width = document.getElementById("center_content").offsetWidth;
                        document.getElementById("left_content").style.width = Math.floor(document.getElementById("left_content").offsetWidth - move_distance) + "px";
                        document.getElementById("center_content").style.width = Math.floor(tmp_center_width + move_distance) + "px";
                    }

                    console.log("latter" + document.getElementById("left_content").style.width + "," + document.getElementById("center_content").style.width);

                    // 中间视频栏目
                    document.getElementById("video1_box").style.height = Math.ceil(document.getElementById("center_content").offsetWidth * 0.75) + "px";
                    document.getElementById("video1_box").style.marginTop =
                        Math.floor(document.getElementById("center_content").offsetHeight / 2 -
                            document.getElementById("video1_box").offsetHeight / 2) + "px";

                    // console.log("move_dis:" + move_distance);
                    // 释放全局捕获
                    if (oDiv0.releaseCapture) {
                        oDiv0.releaseCapture();
                    }
                }

                return false;
            }

            // 按键2的设置
            oDiv1.onmousedown = function (ev) {
                // 获取event对象，兼容性写法
                var ev = ev || event;

                // 鼠标按下时的位置
                var mouseDownX = ev.clientX;
                var mouseDownY = ev.clientY;

                // 方块上下左右四个边的位置和方块的长宽
                var L0 = this.offsetLeft;
                var R0 = this.offsetLeft + this.offsetWidth;
                var W = this.offsetWidth;
                var H = this.offsetHeight;
                var had_mouseMove=false;

                // IE8 取消默认行为-设置全局捕获
                if (oDiv1.setCapture) {
                    oDiv1.setCapture();
                }

                document.onmousemove = function (ev) {
                    var ev = ev || event;
                    had_mouseMove = true;

                    // 鼠标移动时的鼠标位置
                    var mouseMoveX = ev.clientX;
                    var mouseMoveY = ev.clientY;

                    let maxleft = document.getElementById("center_content").offsetLeft,
                        maxright1 = document.getElementById("right_content").offsetLeft +
                            document.getElementById("right_content").offsetWidth;

                    console.log("width:" + (window.innerWidth - document.getElementById("resize_fuzhu_btn0").offsetLeft));
                    document.getElementById("resize_fuzhu_btn0").style.display = "block";
                    if (mouseMoveX <= maxleft + 356) {
                        document.getElementById("resize_fuzhu_btn0").style.left = Math.ceil(maxleft + 355) + "px";
                    } else if (mouseMoveX >= maxright1 - 216) {
                        document.getElementById("resize_fuzhu_btn0").style.right =
                            Math.floor(maxright1 - 200) + "px";
                    } else {
                        document.getElementById("resize_fuzhu_btn0").style.left = mouseMoveX - 5 + "px";
                    }

                    // 设置移动数据
                    move0_left = document.getElementById("resize_fuzhu_btn0").offsetLeft;
                    console.log(move0_left);
                }

                document.onmouseup = function () {
                    if (!had_mouseMove) return;

                    document.onmousemove = null;
                    document.getElementById("resize_fuzhu_btn0").style.display = "none";

                    // 调整尺寸
                    let left_move = move0_left;
                    let move_distance = document.getElementById("right_content").offsetLeft - 10 - left_move;
                    document.getElementById("center_content").style.width = document.getElementById("center_content").offsetWidth - move_distance + "px";
                    document.getElementById("right_content").style.width = document.getElementById("right_content").offsetWidth + move_distance + "px";

                    console.log("leftmove:"+left_move);
                    console.log("move_distance:"+move_distance);

                    // 中测视屏栏目
                    document.getElementById("video1_box").style.height = Math.ceil(document.getElementById("center_content").offsetWidth * 0.75) + "px";
                    document.getElementById("video1_box").style.marginTop =
                        Math.floor(document.getElementById("center_content").offsetHeight / 2 -
                            document.getElementById("video1_box").offsetHeight / 2) + "px";
                    // 右侧栏目内容尺寸
                    document.getElementById("video2_box").style.width = document.getElementById("right_content").offsetWidth + "px";
                    document.getElementById("message_box").style.width = document.getElementById("right_content").offsetWidth + "px";
                    document.getElementById("video2_box").style.height = Math.ceil(document.getElementById("right_content").offsetWidth * 0.75) + "px";
                    document.getElementById("message_box").style.height = Math.floor(document.getElementById("right_content").offsetHeight - document.getElementById("video2_box").offsetHeight - 1) + "px";


                    // 释放全局捕获
                    if (oDiv1.releaseCapture) {
                        oDiv1.releaseCapture();
                    }
                }

                return false;
            }

            // 按键3的设置
            oDiv2.onmousedown = function (ev) {
                // 获取event对象，兼容性写法
                var ev = ev || event;

                // 鼠标按下时的位置
                var mouseDownX = ev.clientX;
                var mouseDownY = ev.clientY;

                // 方块上下左右四个边的位置和方块的长宽
                var T0 = this.offsetTop;
                var B0 = this.offsetTop + this.offsetHeight;
                var W = this.offsetWidth;
                var H = this.offsetHeight;

                // IE8 取消默认行为-设置全局捕获
                if (oDiv2.setCapture) {
                    oDiv2.setCapture();
                }

                document.onmousemove = function (ev) {
                    var ev = ev || event;

                    // 鼠标移动时的鼠标位置
                    var mouseMoveX = ev.clientX;
                    var mouseMoveY = ev.clientY;

                    let maxtop = document.getElementById("assess_note_box").offsetTop,
                        maxbottom1 = document.getElementById("assess_note_box").offsetTop +
                            document.getElementById("assess_note_box").offsetHeight;

                    console.log("height:" + mouseMoveY);
                    document.getElementById("resize_fuzhu_btn2").style.width =
                        document.getElementById("left_content").offsetWidth + "px";
                    document.getElementById("resize_fuzhu_btn2").style.display = "block";

                    if (mouseMoveY <= 255) {
                        document.getElementById("resize_fuzhu_btn2").style.top = 250 + "px";
                    } else if (mouseMoveY >= maxbottom1 - 215) {
                        document.getElementById("resize_fuzhu_btn2").style.bottom =
                            Math.floor(maxbottom1 - 210) + "px";
                    } else {
                        document.getElementById("resize_fuzhu_btn2").style.top = mouseMoveY - 5 + "px";
                    }

                    // 设置移动数据
                    move0_top = document.getElementById("resize_fuzhu_btn2").offsetTop;
                    console.log(move0_left);
                }

                document.onmouseup = function () {

                    document.onmousemove = null;
                    document.getElementById("resize_fuzhu_btn2").style.display = "none";

                    // 调整尺寸
                    let top_move = move0_top;
                    let move_distance = document.getElementById("resize_btn3").offsetTop - top_move;
                    document.getElementById("vitae_box").style.height = document.getElementById("vitae_box").offsetHeight - move_distance + "px";
                    document.getElementById("assess_note_box").style.height = document.getElementById("assess_note_box").offsetHeight + move_distance + "px";

                    // 释放全局捕获
                    if (oDiv2.releaseCapture) {
                        oDiv2.releaseCapture();
                    }
                }

                return false;
            }

        </script>


    </div>


    <!-- 后端内容 -->
    <script src="../../../assets/js/jquery.min.js"></script>
    <script src="../../../assets/js/jquery.i18n.properties.min.js"></script>
    <script src="../../../assets/js/metisMenu.min.js"></script>
    <script src="../../../assets/js/jquery.slimscroll.min.js"></script>
    <script src="../../../assets/js/bootstrap.min.js"></script>
    <script src="../../../assets/js/vconsole.min.js"></script>
    <script src="../../../assets/js/custom.js"></script>
    <script src="../../../KeyCenter.js"></script>
    <script src="index.js"></script>
</body>

</html>